$('form').submit(function (e) {
    e.preventDefault();
});


let form_dt = [];
$('#btn_submit').on('click', function (e) {
    var json = $('form').serializeJSON();
    //BE post to fs

    form_dt.push(json);//$.post("/api/url", data) -> to backend

    get_table_data();//after success then get all data

});



function get_table_data(){
    $('#table_test tbody').empty();
    let a = 0;
    //form_dt generated by $.get("/api/url")
    form_dt.forEach((d) => {
        $('#table_test tbody').append(`
            <tr>
                <td>${(a+1)}</td>
                <td>
                    <b>${d.full_name}</b>
                    <br/>
                    ${d.email}
                    <br/>
                    ${d.major}
                </td>
                <td>
                    <i class="md-icon material-icons uk-text-primary view_dt" key="${a}">visibility</i>
                    <i class="md-icon material-icons uk-text-warning edit_dt" key="${a}">edit</i>
                    <i class="md-icon material-icons uk-text-danger delete_dt" key="${a}">delete</i>
                </td>
            </tr>
        `);
        a++;
    })
}




$("#search_table_test").on("keyup", function() {
  var value = $(this).val().toLowerCase();
  $("#table_test tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
  });
});





$(document).on("click", ".view_dt",  function(){
    k = $(this).attr("key");
    //BE -> $.get("api/url/key") -> by id / key
    html = `
        <span>Name: <b>${form_dt[k].full_name}</b></span>
        <br/>
        <span>Email: <b>${form_dt[k].email}</b></span>
        <br/>
        <span>Major: <b>${form_dt[k].major}</b></span>
    `;

    Swal.fire({
      html: html,
      showCloseButton: false,
      showConfirmButton: true,
      showCancelButton: false,
      focusConfirm: false,
      animation: false,
      closeOnClickOutside: false,
      allowOutsideClick: false
    });
})


$(document).on("click", ".edit_dt",  function(){
    k = $(this).attr("key");
    //BE -> $.get("api/url/key") -> by id / key
    //then push to the form

    $('[name="email"]').val(form_dt[k].email)
    $('[name="full_name"]').val(form_dt[k].full_name)
    $('[name="major"]').val(form_dt[k].major)
})


$(document).on("click", ".delete_dt",  function(){
    k = $(this).attr("key");
    Swal.fire({
      title: 'Are you sure?',
      text: "You won't be able to revert this!",
      type: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.value) {
        //BE -> $.post("api/url/key")
        Swal.fire(
          'Deleted!',
          'Your file has been deleted.',
          'success'
        )
      }
    })
})
